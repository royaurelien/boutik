<odoo>
    <!-- Model = product_template -->
    <record id="product_template_form_view" model="ir.ui.view">
        <field name="name">stock_margin_form_view</field>
        <field name="model">product.template</field>
        <field name="inherit_id" ref="product.product_template_form_view"/>
        <field name="arch" type="xml">

            <xpath expr="//div[@name='standard_price_uom']" position="after">
                <field name="margin" widget="monetary" attrs="{'invisible': [('product_variant_count', '&gt;', 1)]}"/>
                <field name="margin_rate" widget="percentage" attrs="{'invisible': [('product_variant_count', '&gt;', 1)]}"/>
            </xpath>

        </field>
    </record>
    
    <record id="product_variant_easy_edit_view" model="ir.ui.view">
        <field name="name">stock_margin_variant_form_view</field>
        <field name="model">product.product</field>
        <field name="inherit_id" ref="product.product_variant_easy_edit_view"/>
        <field name="arch" type="xml">

            <xpath expr="//field[@name='standard_price']" position="after">
                <field name="margin" widget="monetary"/>
                <field name="margin_rate" widget="percentage"/>
            </xpath>

        </field>
    </record>
    
    <record id="product_template_tree_view" model="ir.ui.view">
        <field name="name">stock_margin_tree_view</field>
        <field name="model">product.template</field>
        <field name="inherit_id" ref="product.product_template_tree_view"/>
        <field name="arch" type="xml">

            <xpath expr="//field[@name='standard_price']" position="after">
                <field name="margin" widget="monetary" optional="show"/>
                <field name="margin_rate" widget="percentage" optional="show"/>
            </xpath>

        </field>
    </record>
    
    <record id="product_product_tree_view" model="ir.ui.view">
        <field name="name">stock_margin_product_tree_view</field>
        <field name="model">product.product</field>
        <field name="inherit_id" ref="product.product_product_tree_view"/>
        <field name="arch" type="xml">

            <xpath expr="//field[@name='standard_price']" position="after">
                <field name="margin" widget="monetary" optional="show"/>
                <field name="margin_rate" widget="percentage" optional="show"/>
            </xpath>

        </field>
    </record>    
    
    
    <record id="action_recalc_margin" model="ir.actions.server">
        <field name="name">Recalc margin</field>
        <field name="model_id" ref="model_product_template"/>
        <field name="binding_model_id" ref="product.model_product_template"/>
        <field name="binding_view_types">list</field>
        <field name="state">code</field>
        <field name="code">
            action = records.action_recalc_margin()
        </field>
    </record>
    
    <record id="action_check_margin" model="ir.actions.server">
        <field name="name">Check margin</field>
        <field name="model_id" ref="model_product_template"/>
        <field name="binding_model_id" ref="product.model_product_template"/>
        <field name="binding_view_types">list</field>
        <field name="state">code</field>
        <field name="code">
            action = records.action_check_margin()
        </field>
    </record>    
    
</odoo>